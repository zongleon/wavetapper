import{A as I,a as T,c as h,D as g,b as N,O as c,P as S,S as A,d as D,s as O}from"./utils-BCSHFl62.js";const b=document.getElementById("name-input"),P=document.getElementById("name-submit"),j=document.getElementById("name-picker-modal"),L=document.getElementById("name"),y=document.getElementById("header");y.style.display="none";let u="";P.addEventListener("click",async()=>{await J(),u=b.value.trim(),u?(L.textContent=u,j.style.display="none",y.style.display="block"):b.placeholder="enter a name..."});const a=new I;await a.init({background:"#dadada",resizeTo:window});const v=Math.min(a.canvas.width,a.canvas.height)/6,E=v*1.3,C=v*1.4,w=v/105;document.getElementById("pixi-container").appendChild(a.canvas);const R=await T.load("/assets/0.jpg"),f=await T.load("/assets/tilesetwhite.png");f.source.scaleMode="nearest";let o=[],M=[],m=0,n=null,r=null,d=null;function _(){if(r&&r.remove(),d&&d.remove(),r=document.createElement("button"),d=document.createElement("button"),r.innerText="←",d.innerText="→",r.className="design-arrow left-arrow",d.className="design-arrow right-arrow",document.body.appendChild(r),document.body.appendChild(d),r.onclick=()=>x(-1),d.onclick=()=>x(1),n===15){const e=document.createElement("button");e.innerText="Select",e.className="select-button",document.body.appendChild(e),e.onclick=()=>{l.send(new c.Message("/player/setting",n,m))}}}function x(e){if(n===null)return;const t=g[n][0];m=(m+e+t.length)%t.length,n!=15&&l.send(new c.Message("/player/setting",n,m)),B()}function B(){if(n===null)return;const e=h(a,f,g[n][0][m],n),t=h(a,f,g[n][1][m],n),s=o[n];s.children.length>=3&&O(s,[e.composite,t.composite,e.solid])}for(let e=0;e<4;e++)for(let t=0;t<4;t++){const s=h(a,f,g[e*4+t][0][0],e*4+t),i=N((a.canvas.width-3.5*E)/2+t*E,(a.canvas.height-3.5*C)/2+e*C,w,R,s.bg);k(i),M.push(i.y),o.push(i),a.stage.addChild(i)}const l=G();function G(){const e=new c.WebsocketClientPlugin({host:A,port:S,secure:!0}),t=new c({discardLateMessages:!0,plugin:e});return t.on("open",()=>{t.send(new c.Message("/viewing",1))}),t.on("/players",s=>{if(n!=null)return;let i=JSON.parse(s.args[0]);i.forEach(p=>{p.pos=Number(p.pos),p.setting=Number(p.setting)}),z(i)}),t.open(),t}function q(e){console.log("joining!"),n=e,l.send(new c.Message("/join",u,e)),l.on(`/ping/${e}`,s=>{l.send(new c.Message(`/pong/${e}`,1))});for(let s=0;s<o.length;s++)s!==e&&a.stage.removeChild(o[s]);const t=o[e];t.x=a.canvas.width/2,t.y=a.canvas.height/3,t.scale.set(Math.max(a.canvas.width,a.canvas.height)/105/3),M[e]=t.y,B(),_(),y.style.display="none"}function z(e){for(let t=0;t<o.length;t++)e.find(i=>i.pos==t)!==void 0?(o[t].off("pointerdown"),o[t].off("pointerenter"),o[t].off("pointerleave"),o[t].tint=11184810):(k(o[t]),o[t].tint=16777215)}function k(e){e.on("pointerdown",()=>{const t=o.indexOf(e);t!==-1&&(q(t),e.off("pointerenter"),e.off("pointerleave"),e.off("pointerdown"),e.on("pointerdown",()=>{D(e,M[t]),l.send(new c.Message("/player/tap",n))}))}),e.on("pointerenter",()=>{e.scale.set(w*1.2)}),e.on("pointerleave",()=>{e.scale.set(w)})}async function J(){typeof DeviceOrientationEvent.requestPermission=="function"&&await DeviceOrientationEvent.requestPermission(),window.addEventListener("deviceorientation",e=>{if(n===null)return;const{beta:t,gamma:s}=e,i=Math.max(-.2,Math.min(.2,t/90)),p=Math.max(-1,Math.min(1,s/90));l.send(new c.Message("/player/volume",n,i)),l.send(new c.Message("/player/pan",n,p))},!1)}
